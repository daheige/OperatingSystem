## 第二章：操作系统简介

如果你正在学习小学二年级的课程，你应该已经有一些关于计算机程序如何运行的了解。如果没有的话，这本书(和相应的课程)学习起来会很困难。——因此你最好停止阅读这本书，或者跑到最近的书店，并在学习必要的前置技术背景之后再继续阅读。

那么程序运行时会发生什么？

一个正在运行的程序做了一件非常简单的事情:**执行指令**。

处理器每秒从内存中**获取(fetches)**数百万次(甚至数十亿次)指令，对于每一条指令来说，处理器先进行**解码(decode)**(即弄清这是哪条指令)，然后**解释(executes)**指令(也就是说，可以完成程序应做的事情，比如说数字相加、访问内存、执行函数等等...)。在完成此条指令之后，处理器将继续执行下一条指令，以此类推，直到最终程序完成。

我们刚刚描述了**冯·诺依曼(Von Neumann)**计算模型的基础。听起来超级简单对吧？但是在本课中，我们将学习到，在程序运行时，还有许多其他疯狂的东西来使系统更**易于使用**。

事实上，有一套软件可以简化程序的运行(甚至可以让你同时运行大量的程序)，它允许程序共享内存，使程序和设备进行交互，以及其他类似的有趣玩意儿。这套软件叫做**操作系统(OS)**，它负责确保系统以易于使用的方式正确有效地执行。

操作系统简化程序的主要方式是通过一种叫作**虚拟化(Virtualization)**的通用技术。也就是说，操作系统会占用**物理(physical)**资源(例如说处理器，内存或硬盘)，将其转化为一个更通用，功能更强大，并且易于使用的**虚拟(virtual)**形式。因此，我们有时会将操作系统成为**虚拟机(virtual machine)**。

当然，为了允许用户告诉操作系统该怎么做，以利用虚拟机的功能(例如运行程序，分配内存或访问文件)，操作系统还提供了一些可以被用户调用的**接口(API)**。实际上，一个典型的操作系统会导出数百个可供应用程序使用的**系统调用(system calls)**。因为操作系统提供了这些调用来运行程序、访问内存和设备以及其他相关的操作，所以我们有时也说操作系统为应用程序提供了**标准库(standard library)**。

最后，由于虚拟化允许许多程序同时运行(共享CPU)、同时访问自己的指令和数据(共享内存)、访问设备(共享磁盘)，因此操作系统有时也被称为**资源管理器(resource manager)**。每个CPU、内存和磁盘都是系统的资源。因此，操作系统的角色就是以高效、公平、或考虑其他目标的方式进行管理这些资源。为了更好的了解操作系统的作用，让我们看一些示例。

```c
#include <stdio.h>
#include <stdlib.h>
#include <sys/time.h>
#include <assert.h>
#include "common.h"

int main(int argc, char *argv[])
{
	if (argc != 2) {
		fprintf(stderr, "usage: cpu <string>\n");
		exit(1);
	}
	char *str = argv[1];
	while (1) {
		Spin(1);
		printf("%s\n", str);
	}
	return 0;
}

```

图片2.1:**代码循环并打印**



<h4>2.1 虚拟CPU</h4>

原书26页